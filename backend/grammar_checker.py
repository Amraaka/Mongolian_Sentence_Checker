import nltk
from nltk import CFG

word_lexicon = {
    'PRO': ['Би', 'Тэр', 'Чи'],
    'V': [
        'агшаав', 'ажиллав', 'алхав', 'арилгав', 'арчив', 'асаав', 'авлаа', 'авчирлаа', 'ажиглав',
        'барыв', 'бодлоо', 'боов', 'бүлээв', 'будав', 'буцалгав', 'бичив', 'бүлээв', 'гарав',
        'гаргав', 'гуйв', 'гүйцэтгэлээ', 'дууллаа', 'дүүргэлээ', 'засав', 'зочлов', 'зурлаа',
        'зүүв', 'зуурлаа', 'идэв', 'инээв', 'ийв', 'нээв', 'онгойлгов', 'орлоо', 'өглөө', 'өмсов',
        'өшиглөв', 'тавив', 'тайрав', 'татав', 'тоглов', 'түүв', 'тэжээв', 'тэжээлээ', 'уншив',
        'унав', 'уув', 'услав', 'угаав', 'үзэв', 'үлээлээ', 'үүрэв', 'хайлууллаа', 'хагалав',
        'хамав', 'харлаа', 'хийв', 'хольсон', 'хугаллаа', 'хутгав', 'хөглөв', 'хөрөв', 'хөрөөдөв',
        'цавчив', 'цохив', 'цэвэрлэв', 'чанав', 'шарав', 'шарлаа', 'шигшив', 'шилжүүлэв',
        'шургууллаа', 'эргүүлэв', 'эвхэв', 'ярив', 'өнгөлөв', 'үлээлээ', 'хянав', 'шүүрдэв',
        'сонууллаа', 'хөтөлөв', 'сольлоо', 'жижиглэв', 'мэдэрлээ', 'соруулав', 'зүүв', 'хамав',
        'шарлаа', 'хэмжив', 'зүлгэв', 'шивэв', 'хөглөв', 'тогтов', 'шарлаа', 'хөтөлөв'
    ],
    'N': [
        'агшаамал', 'алдаа', 'амттан', 'аяга', 'авдар', 'баг', 'багаж', 'бэлэг', 'бөмбөг', 'боов',
        'будаг', 'будаа', 'будаан', 'булан', 'гэр', 'гэрэл', 'гутал', 'даалин', 'дарш', 'даалгавар',
        'дэвтэр', 'дэвсгэр', 'дэлгүүр', 'дэр', 'дээвэр', 'дуу', 'дугуй', 'жимс', 'жижигрүүлэв',
        'зайрмаг', 'засмал', 'зураг', 'зураас', 'лаа', 'лааз', 'лонх', 'лууван', 'мах', 'мод',
        'мөөг', 'найздаа', 'нар', 'ном', 'ноорог', 'нойтон', 'нунтаг', 'сав', 'саванг', 'самбар',
        'сандал', 'сар', 'сүү', 'сүүдэр', 'суудал', 'сургууль', 'талбай', 'талбайд', 'талх',
        'тавиур', 'ташуур', 'толь', 'тор', 'торго', 'тэмдэг', 'тэмдэглэл', 'түлхүүр', 'түлээ',
        'тоос', 'утас', 'утсаар', 'ундаа', 'ус', 'усан үзэм', 'хайрцаг', 'хаалга', 'хашаа',
        'хашааг', 'хадаас', 'хариу', 'хивс', 'хийл', 'хичээл', 'хонийг', 'хувцсаа', 'хуудас',
        'хуудсыг', 'хулдаас', 'хумс', 'хөтөл', 'цагаа', 'цай', 'цамц', 'цаас', 'цонх', 'цэцэг',
        'цэцэрлэгт', 'цүнх', 'чанамал', 'чихэр', 'чийг', 'чулуу', 'шал', 'шатар', 'шохой',
        'шөл', 'шүүдэр', 'шүүс', 'шүүр', 'өд', 'өнгө', 'өрөө', 'үзэг', 'үнсгэл', 'үхрийн',
        'үүл', 'хайрцаг', 'хөтөл', 'видео', 'бөгж', 'самар', 'шороо', 'тэмдэглэл', 'хянав',
        'навч', 'загас', 'жигнэмэг', 'ваар', 'тагтай', 'мухар', 'хөтөл', 'цас'
    ],
    'ADJ': ['том', 'улаан', 'шинэ', 'жижиг']
}

grammar_structure = """
  S -> NP VP
  VP -> NP V
  NP -> PRO | N | ADJ N
"""

def build_grammar(lexicon, structure):
    lexicon_rules = []
    for tag, words in lexicon.items():
        formatted_words = [f"'{w}'" for w in words]
        rule = f"{tag} -> {' | '.join(formatted_words)}"
        lexicon_rules.append(rule)
    return structure + "\n" + "\n".join(lexicon_rules)

full_grammar_text = build_grammar(word_lexicon, grammar_structure)
grammar = CFG.fromstring(full_grammar_text)
parser = nltk.ChartParser(grammar)

def is_sentence_correct(sentence: str) -> bool:
    tokens = sentence.strip().split()
    try:
        parses = list(parser.parse(tokens))
        return bool(parses)
    except ValueError:
        return False
